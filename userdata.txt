#cloud-config

write_files:
-   encoding: b64
    content: ${prepare_concourse_keys}
    path: /home/ec2-user/prepare_concourse_keys.sh
    permissions: '0744'
-   encoding: b64
    content: ${concourse_worker_service}        
    path: /etc/systemd/system/concourse_worker.service
    permissions: '0755'  
-   encoding: b64
    content: ${swap_service}
    path: /etc/systemd/system/swap.service
    permissions: '0755'
-   encoding: b64
    content: ${concourse_web_service}
    path: /etc/systemd/system/concourse_web.service
    permissions: '0755'
-   encoding: b64
    content: ${concourse}
    path: /home/ec2-user/concourse.sh
    permissions: '0755'

repo_update: true
repo_upgrade: all
packages: 
  docker

runcmd:
  - systemctl enable docker
  - systemctl start docker
  - systemctl start swap
  - systemctl start concourse_web.service
  - systemctl enable concourse_web.service
  - sleep 3m
  - systemctl start concourse_worker.service
  - systemctl enable concourse_worker.service